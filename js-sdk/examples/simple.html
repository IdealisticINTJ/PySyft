<!DOCTYPE html>
<html>
<head>
    <title>SyftSDK Test</title>
    <style>
        /* Theme variables */
        :root[data-theme="light"] {
            --bg-color: #ffffff;
            --text-color: #333333;
            --button-bg: #f0f0f0;
            --button-text: #333333;
            --button-hover: #e0e0e0;
            --pre-bg: #f5f5f5;
            --border-color: #dddddd;
        }

        :root[data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --button-bg: #333333;
            --button-text: #ffffff;
            --button-hover: #444444;
            --pre-bg: #2d2d2d;
            --border-color: #444444;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            transition: all 0.3s ease;
        }

        h1 {
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            background-color: var(--button-bg);
            color: var(--button-text);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        button:hover {
            background-color: var(--button-hover);
        }

        #output {
            margin-top: 20px;
        }

        pre {
            background-color: var(--pre-bg);
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        /* Theme toggle button specific styles */
        #theme-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        #theme-toggle svg {
            width: 16px;
            height: 16px;
            fill: var(--button-text);
        }
    </style>
</head>
<body>
    <h1>SyftSDK Test</h1>
    <div class="controls">
        <button id="theme-toggle">
            <svg class="sun" viewBox="0 0 24 24">
                <path d="M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.65 0-3 1.35-3 3s1.35 3 3 3 3-1.35 3-3-1.35-3-3-3zm0-2c.28 0 .5-.22.5-.5v-3c0-.28-.22-.5-.5-.5s-.5.22-.5.5v3c0 .28.22.5.5.5zm0 13c-.28 0-.5.22-.5.5v3c0 .28.22.5.5.5s.5-.22.5-.5v-3c0-.28-.22-.5-.5-.5zm8.5-6.5h-3c-.28 0-.5.22-.5.5s.22.5.5.5h3c.28 0 .5-.22.5-.5s-.22-.5-.5-.5zm-14 0h-3c-.28 0-.5.22-.5.5s.22.5.5.5h3c.28 0 .5-.22.5-.5s-.22-.5-.5-.5z"/>
            </svg>
        </button>
        <button onclick="testRPC()">Test RPC Call</button>
        <button onclick="showLocalStorage('output')">Show LocalStorage</button>
        <button onclick="clearLocalStorage('output')">Clear Storage</button>
    </div>
    <div id="output"></div>

    <!-- Import the SDK as a module -->
    <script type="module">        
        // ----- Theme handling -----
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
        const savedTheme = localStorage.getItem('theme');
        const root = document.documentElement;
        
        // Set initial theme
        if (savedTheme) {
            root.setAttribute('data-theme', savedTheme);
        } else {
            root.setAttribute('data-theme', prefersDark.matches ? 'dark' : 'light');
        }

        // Theme toggle handler
        document.getElementById('theme-toggle').addEventListener('click', () => {
            const currentTheme = root.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            root.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        // Listen for system theme changes
        prefersDark.addEventListener('change', (e) => {
            if (!localStorage.getItem('theme')) {
                root.setAttribute('data-theme', e.matches ? 'dark' : 'light');
            }
        });
        // ----- End of Theme handling -----

        import { SyftSDK, showLocalStorage, clearLocalStorage } from '../sdk.js';

        // Make SDK available globally for the button handlers
        window.sdk = new SyftSDK();
        
        // Define global functions for button handlers
        window.testRPC = async function() {
            console.log("test rpc/");
            try {
                const response = await window.sdk.rpc(
                    "syft://shubham@openmined.org/public/rpc",
                    {
                        'Content-Type': 'application/json',
                        'User-Agent': 'MyApp/1.0'
                    },
                    "Ping!",
                );
                document.getElementById('output').innerHTML = 
                    `<pre>RPC Response: ${JSON.stringify(response, null, 2)}</pre>`;
            } catch (error) {
                document.getElementById('output').innerHTML = 
                    `<pre>Error: ${error.message}</pre>`;
            }
        }

        window.showLocalStorage = showLocalStorage;
        window.clearLocalStorage = clearLocalStorage;
    </script>
</body>
</html>